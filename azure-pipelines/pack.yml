steps:
- task: DownloadPipelineArtifact@2
  displayName: ðŸ”» Download Windows binaries
  inputs:
    buildType: current
    targetPath: src/nerdbank-zcash-rust/target
    artifactName: rust-Windows
- task: DownloadPipelineArtifact@2
  displayName: ðŸ”» Download Linux binaries
  inputs:
    buildType: current
    targetPath: src/nerdbank-zcash-rust/target
    artifactName: rust-Linux
- task: DownloadPipelineArtifact@2
  displayName: ðŸ”» Download android binaries
  inputs:
    buildType: current
    targetPath: src/nerdbank-zcash-rust/target
    artifactName: rust-android
- task: DownloadPipelineArtifact@2
  displayName: ðŸ”» Download macOS binaries
  inputs:
    buildType: current
    targetPath: src/nerdbank-zcash-rust/target
    artifactName: rust-macOS

- pwsh: src/nerdbank-zcash-rust/Generate-3rdPartyNotices.ps1
  displayName: ðŸªª 3rd party licenses

- script: dotnet build -t:build,pack -p:Platform=x64 --no-restore -c $(BuildConfiguration) -warnaserror /bl:"$(Build.ArtifactStagingDirectory)/build_logs/pack_x64.binlog"
  displayName: ðŸ›  build (x64)

- script: dotnet build -t:build,pack -p:Platform=arm64 --no-restore -c $(BuildConfiguration) -warnaserror /bl:"$(Build.ArtifactStagingDirectory)/build_logs/pack_arm64.binlog"
  displayName: ðŸ›  build (arm64)

- powershell: azure-pipelines/artifacts/_pipelines.ps1 -ArtifactNameSuffix "-$(Agent.JobName)" -Verbose
  failOnStderr: true
  displayName: ðŸ“¢ Publish artifacts
  condition: succeededOrFailed()

- powershell: dotnet nuget push 'bin/Packages/$(BuildConfiguration)/*.nupkg' -s $(ci_feed) -k azdo --skip-duplicate
  displayName: ðŸ“¦ Push packages to CI feed
  condition: and(succeeded(), ne(variables['ci_feed'], ''), ne(variables['Build.Reason'], 'PullRequest'))
